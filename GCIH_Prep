Eradication
- Undoing the threat actor's actions
  - Containment is about stopping their operations
  - Eradication is about removing them
- Examples activities
  - Resotring systems from trusted backups
  - Removing threat actor processes, accounts
  - Performing a vulnerability assessment
- May also help meet goals such as recovery
  - Dealing with fraudulent transactions
  - Modified source code

Recovery
- Business needs to get back up and running
- Rebuilding a system is often the most cost effective
  - Not always possible
  - May consider shorter-term containment options as a band-aid to buy time
- Try to bring systems online during off-hours
  - Easier to monitor
  - This is a business decision... so you may be overruled

Remediation
- Try to identify and fix the root cause
- Compromise due to a weak password
  - Why was the weak password allowed? 
  - Can be difficult if multiple factors involved
- Closely monitor any compromised systems
  - A rootkit and/or backdoor suggests intent to return  
  - Monitor network sensors, host, and application logs
  - Look for incident-specific IOCs

Post-Incident
- Develop a final report (Tailor to your audience)
- Right after an incident, there is a lot of momentum
  - The impact fades over-time
- Schedule a follow-up review
  - What has been implemented?
  - Has the organization been compromised again? Original compromise?
  - Timeframe varies, but 30, 60, and 90-day increments are not uncommon

---------------------------------------------------------------------------------------
Useful PowerShell Commands for IR -
- Get-Process
- Get-Process 'powersh*'
- Get-Process 'powershell' | Select-Object *
- Get-Process -ComputerName SEC504STUDENT
- Get-CimInstance
- Get-CimInstance -Class Win32_process | Select-Object -Property Name,ParentProcessId,ProcessId,CommandLine

- Get-NetTCPConnection
  - Get-NetTCPConnection -State Listen | Select-Object -Property LocalAddress,LocalPort,OwningProcess

- Get-ItemProperty
- Get-ChildItem
  - Get-ItemProperty

- Get-PSDrive

- Get-LocalUser
- Get-LocalGroup
- Get-LocalGroupMember

- Get-ScheduledTask
- Export-ScheduledTask
- Get-ScheduledTaskInfo

- Get-WinEvent

- Compare-Object
- Select-Object
- Out-File

Get-LocalUser | Select-Object -ExpandProperty Name > users-baseline.txt
get-content on users; add user
Get-LocalUser | Select-Object -ExpandProperty Name > users-current.txt
$baseline = Get-Content .\users-baseline.txt
$current = Get-Content .\users-current.txt
Compare-Object $baseline $current

-Memory investigation steps are similar to live investigation steps
	- We use Volatility to analyze memory instead of PowerShell cmdlets
• The analysis process starts with the EOl
	- Suspicious process? Start with PsList and Ps Tree
	- Suspicious network listener? Start with NetScan, then move to processes
	- Suspicious program? Start with CmdLine, then processes
• Get in the habit of documenting your analysis process
	- Retain the results of Volatility plugin analysis by redirecting the output to a file
	- Add - g to suppress the Volatility progress indicator

- How do you know if an unknown program is evil?
	- Suspicious isn't necessarily malicious
	- Oddly named executables aren't enough, might still be benign
• How can you determine indicators?
	- Someone might have reverse engineered it already
	- But not always ... and sometimes signatures change
• Malware investigations can also feed threat intelligence
• Two basic approaches
	- Monitoring the environment: behavioral analysis
	- Examining code: static analysis

- Online engine that performs various types of automated analysis
• VirusTotal will run a specimen through several antivirus engines
	- Can purchase access to uploaded specimens
• Hybrid Analysis has sandboxes that run malware and record activity
	- Can choose if sample should be shared with community
	- Offers a commercial onsite product

- Minimize attack surface for the malware
Storm Center
• Never investigate malware on your day-to-day host... ever
	- An air-gapped system that you wipe after each use is ideal
• More common to use a VM
	- Use host-only (or equivalent) networking
	- Enable firewalls and other measures on the host
• Options for transferring data
	- USB devices
	- Temporarily-enabled virtual machine folders

Get-FileHash <file> - Calculate the SHA256 hash of a file on Windows

Monitoring the environment is a common strategy for investigating malware
• Basic strategy:
	- Get environment ready
	- Take a VM snapshot (if applicable)
	- Enable monitoring tools
	- Run malware
	- Interact with malware (optional)
	- Kill malware (optional)
	- Pause monitoring tools
	- Review output

Often requires some knowledge of the target language
	- Even a little understanding goes a long way
• IDA Pro is the most well-known tool in this area
	- Both disassembler and debugger
	- Optional decompiler (Hex-Rays)
	- Commercial
• Ghidra by NSA
	- Released as an open-source tool
	- Has support for collaboration
• Check out FOR610, SEC660 and SEC760 for more

LLM: a type of Al that uses a large data set of knowledge made
accessible through Natural Language
Processing (NLP)
• Generative Al: A type of Al that generates new content from an LLM
• GPT: Generative Pre-training
Transformer (GPT) is a breakthrough
NLP platform from OpenAl.com
	- Many details are not publicly available
	- Available on an experimental basis with subscriber options; limited API access

Problems with AI:
	- When they are wrong, they are confidently wrong
	- "Hallucinations"; hard time differentiating between creative and factual output

 • Influencing ChatGPT's output can improve the value of the results
	- Limit your output to no more than 300 words
	- Use vocabulary appropriate for a 10th grade reading level
	- Focus the results to recommendations for a manufacturing organization
	- Make the response appropriate for a non-technical executive
• You can also train ChatGPT with a sample of your own writing
	- Analyze the writing style sample inside triple quotes and call it My Style

Tips for using ChatGPT
	- Comply with employer rules
	- What is the impact od an OpenAI breach?
	- NOT a replacement for human analysis
	- Practice prompt engineering to refine the results
	- Watch for errors, like hallucinations

• Content is normalized using the nomenclature conventions adopted by ATT&CK
	- This gives you a consistent framework to work from when describing, documenting, and discussing attacker tactics, techniques, and procedures
• Cross-reference tools and techniques with ATT&CK identifiers
	- "Let's talk about password spray attacks" (Credential Access: TA0006)
	- "Donut injects shellcode into existing assemblies and payloads" (Process Injection:
T1055)
• Validation for attack tool and defense realism

- An attacker may start with a single domain name as a target
- What else can they discover for targets to attack
	- Subdomains
	- Partner and Subsidiary Organizations 
	- Non-production systems

	DNS Zone Transfer
- DNS servers may respond to zone transfer requests
	- Intended for replication from primary DNS to backup DNS servers
	- Uncommonly found on public DNS servers, more likely on internal DNS
	- Zone transfers should only be done in the internal network

	Certificate Transparency
• Modern browsers detect untrusted website certificates
• Modern browsers do not do well detecting malicious certs issued by trusted CAs
• Certificate transparency requires CAs to publish certificate issuance logs
	- Open to scrutiny to look for suspicious certs
• Gather information about targets, which CAs are in use, when certs are renewed, and more!
